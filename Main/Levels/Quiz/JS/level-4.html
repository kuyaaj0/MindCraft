<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MindCraft JS Lesson 4 Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%;font-size:10px;overflow:hidden;}
        
        body{
            font-family:'Press Start 2P', cursive;
            background:linear-gradient(#87e4ff,#c8f7b0);
            padding:20px;
            margin:0;
        }

        .quiz-container{
            max-width:1000px;
            margin:0 auto;
            height:calc(100vh - 40px);
            display:flex;
            align-items:center;
            justify-content:center;
            position:relative;
        }

        .wood-border{
            width:100%;
            max-width:900px;
            height:90vh;
            position:relative;
            background:#8b5a2b;
            border-radius:28px;
            padding:16px;
            box-shadow:
                inset -8px -8px 0 rgba(0,0,0,.3),
                0 12px 0 #5c3a1a;
        }

        .wood-border::before{
            content:'MINDCRAFT JS QUIZ';
            position:absolute;
            top:-14px;
            left:50%;
            transform:translateX(-50%);
            background:#8b5a2b;
            padding:6px 20px;
            font-size:11px;
            color:#ffd966;
            text-shadow:2px 2px #000;
            border-radius:10px;
            box-shadow:0 4px 0 #5c3a1a;
        }

        .wood-brand{
            display: none;
        }

        .quiz-content{
            height:100%;
            width:100%;
            background:linear-gradient(#8fe9ff 55%, #7dd37d);
            border-radius:16px;
            padding:24px;
            box-shadow:0 20px 50px rgba(0,0,0,.3);
            display:flex;
            flex-direction:column;
            position:relative;
            z-index:2;
        }

        .main-title{
            text-align:center;
            font-size:16px;
            text-shadow:3px 3px #fff;
            margin-bottom:20px;
            color:#006400;
        }

        .quiz-panel{
            flex:1;
            display:flex;
            flex-direction:column;
            justify-content:center;
            padding:16px;
            overflow:auto;
        }

        .top-bar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:20px;
            font-size:9px;
        }

        .progress{ color:#006400; font-weight:bold; }
        .timer{ color:#b8860b; font-weight:bold; }

        .question-box{
            background:#fff3cd;
            border:3px solid #c9a227;
            padding:20px;
            border-radius:12px;
            margin-bottom:24px;
            line-height:1.6;
            box-shadow:0 6px 0 #c9a227;
            max-height:300px;
        }

        .question-text{
            font-size:11px;
            margin-bottom:16px;
            font-weight:bold;
        }

        .options label{
            display:block;
            margin:10px 0;
            cursor:pointer;
            font-size:9px;
        }

        .options input{
            margin-right:10px;
            transform:scale(1.3);
            accent-color:#006400;
        }

        .fill-input{
            width:100%;
            max-width:380px;
            padding:12px;
            border:3px solid #c9a227;
            background:#fff;
            border-radius:10px;
            font-family:'Press Start 2P', cursive;
            font-size:9px;
            color:#000;
            box-shadow:0 4px 0 #c9a227;
        }

        .nav-row{
            display:flex;
            justify-content:center;
            gap:16px;
            margin-top:20px;
        }

        button{
            font-family:'Press Start 2P', cursive;
            background:#a56b34;
            color:#fff;
            border:none;
            padding:12px 20px;
            border-radius:12px;
            box-shadow:
                inset -4px -4px 0 rgba(0,0,0,.25),
                0 6px 0 #5c3a1a;
            cursor:pointer;
            font-size:8px;
            transition:transform 0.1s;
            min-width:120px;
        }

        button:hover:not(:disabled){
            transform:translateY(-2px);
        }

        button:disabled{
            opacity:0.5;
            cursor:not-allowed;
            transform:none;
            box-shadow: inset -4px -4px 0 rgba(0,0,0,.25), 0 2px 0 #5c3a1a;
        }

        #nextBtn{ background:#a56b34; }
        #finishBtn{ 
            background:#d4af37; 
            box-shadow:
                inset -4px -4px 0 rgba(0,0,0,.25),
                0 6px 0 #b8860b;
            display:none;
        }

        #backBtn{
            background:#ff6b35;
            box-shadow:
                inset -4px -4px 0 rgba(0,0,0,.25),
                0 6px 0 #cc5533;
            display:none;
        }

        #resultBox{
            margin-top:24px;
            padding:20px;
            border-radius:12px;
            font-size:10px;
            text-align:center;
            display:none;
            box-shadow:0 6px 0 #6aa84f;
        }

        .result-success{
            background:#d9ead3 !important;
            border:4px solid #6aa84f !important;
            color:#006400 !important;
            display:block !important;
        }

        @media(max-width:768px){
            .quiz-container{
                height:auto;
                min-height:calc(100vh - 40px);
                align-items:flex-start;
                padding-top:20px;
            }
            body{ overflow:auto; padding:10px; }
            .wood-border{ 
                height:auto; 
                min-height:80vh;
                border-radius:20px; 
                padding:12px; 
            }
            .quiz-content{ padding:18px; border-radius:12px; }
            .main-title{ font-size:14px; }
        }
    </style>
</head>
<body>
<div class="quiz-container">
    <div class="wood-border">
        <div class="wood-brand">
            MindCraft<br>
            <span style="font-size:6px;">JS Lesson 4 ‚Ä¢ Variables Quiz</span>
        </div>

        <div class="quiz-content">
            <div class="main-title">LESSON 4<br><span style="font-size:12px; font-weight:normal;">VARIABLES QUIZ</span></div>

            <div class="quiz-panel">
                <div class="top-bar">
                    <div class="progress" id="progress">Question 1 / 15</div>
                    <div class="timer" id="timer">05:00</div>
                </div>

                <div id="questionContainer" class="question-box"></div>

                <div class="nav-row">
                    <button id="nextBtn">NEXT ‚Üí</button>
                    <button id="finishBtn">FINISH & SCORE</button>
                    <button id="backBtn">‚Üê BACK</button>
                </div>

                <div id="resultBox">Complete all questions for your score!</div>
            </div>
        </div>
    </div>
</div>

<script>
    const STORAGE_KEY = 'mindcraft_js_lesson4_quiz';
    
    const questions = [
        {type: "mc", text: "1. Variables are like ________ that store data in JavaScript.", options: ["Functions","Containers/Boxes","Comments","Loops"], correct: 1},
        {type: "mc", text: "2. Which keyword creates a variable that you CAN change later?", options: ["var","const","let","function"], correct: 2},
        {type: "mc", text: "3. Which keyword creates a variable you CANNOT change?", options: ["let","var","const","if"], correct: 2},
        {type: "mc", text: "4. What will happen if you try to change a const variable?", options: ["It works fine","Browser crashes","ERROR - cannot reassign const","It becomes a let automatically"], correct: 2},
        {type: "mc", text: "5. Which is the BEST use for 'let' variables?", options: ["Fixed values like PI","Counters, scores, temporary data","Function names","HTML elements"], correct: 1},
        {type: "mc", text: "6. Which is the BEST use for 'const' variables?", options: ["Changing scores","Fixed values like MAX_SCORE, PI, STUDENT_ID","Loop counters","Temporary calculations"], correct: 1},
        {type: "mc", text: "7. Which variable name follows camelCase rules?", options: ["1stPlace","student_name","STUDENTNAME","studentName"], correct: 3},
        {type: "mc", text: "8. Variable names must start with:", options: ["A number","A letter, $, or _","Uppercase only","Spaces allowed"], correct: 1},
        {type: "mc", text: "9. What is 'scope' in JavaScript?", options: ["Variable color","Where the variable exists/accessible","Variable size","Comment location"], correct: 1},
        {type: "mc", text: "10. A variable declared inside a function has what scope?", options: ["Global (everywhere)","Local (only inside function)","Browser scope","HTML scope"], correct: 1},
        {type: "fill", text: "11. Use ________ for variables that will change (like scores).", correctText: "let"},
        {type: "fill", text: "12. Use ________ for values that never change (like MAX_SCORE).", correctText: "const"},
        {type: "fill", text: "13. Good variable naming style is called ________Case.", correctText: "camel"},
        {type: "fill", text: "14. Variables inside functions have ________ scope.", correctText: "local"},
        {type: "fill", text: "15. Variables declared outside functions have ________ scope.", correctText: "global"}
    ];

    const TOTAL_TIME_SECONDS = 5 * 60;

    // Global state
    let currentIndex = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let remainingSeconds = TOTAL_TIME_SECONDS;
    let quizCompleted = false;
    let timerInterval = null;

    // DOM elements
    const questionContainer = document.getElementById("questionContainer");
    const progress = document.getElementById("progress");
    const timerDisplay = document.getElementById("timer");
    const nextBtn = document.getElementById("nextBtn");
    const finishBtn = document.getElementById("finishBtn");
    const backBtn = document.getElementById("backBtn");
    const resultBox = document.getElementById("resultBox");

    function loadQuizState() {
        try {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const state = JSON.parse(saved);
                currentIndex = state.currentIndex || 0;
                userAnswers = state.userAnswers || new Array(questions.length).fill(null);
                remainingSeconds = Math.max(0, state.remainingSeconds || TOTAL_TIME_SECONDS);
                quizCompleted = !!state.quizCompleted;
                if (quizCompleted) {
                    resultBox.innerHTML = `
                        <strong>FINAL SCORE: ${state.score} / ${questions.length}</strong><br>
                        <span style="font-size:8px;">${state.percentage}% - Variable mastery logged!</span>
                    `;
                    resultBox.className = "result-success";
                    resultBox.style.display = "block";
                }
                return true;
            }
        } catch (e) {
            console.log('Failed to load quiz state');
        }
        return false;
    }

    function saveQuizState() {
        try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                currentIndex,
                userAnswers,
                remainingSeconds,
                quizCompleted,
                score: quizCompleted ? calculateScore() : undefined,
                percentage: quizCompleted ? Math.round((calculateScore() / questions.length) * 100) : undefined
            }));
        } catch (e) {
            console.log('Failed to save quiz state');
        }
    }

    function formatTime(secs) {
        const m = Math.floor(secs / 60);
        const s = secs % 60;
        return `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
    }

    function updateTimerDisplay() {
        timerDisplay.textContent = formatTime(remainingSeconds);
    }

    function startTimer() {
        if (timerInterval !== null || quizCompleted) return;
        updateTimerDisplay();
        timerInterval = setInterval(() => {
            remainingSeconds = Math.max(0, remainingSeconds - 1);
            updateTimerDisplay();
            saveQuizState();
            if (remainingSeconds <= 0) {
                clearInterval(timerInterval);
                timerInterval = null;
                if (!quizCompleted) finishQuiz();
            }
        }, 1000);
    }

    function loadQuestion(index) {
        const q = questions[index];
        progress.textContent = `Question ${index + 1} / ${questions.length}`;
        questionContainer.innerHTML = `<div class="question-text">${q.text}</div>`;

        if (q.type === "mc") {
            const optionsDiv = document.createElement("div");
            optionsDiv.className = "options";
            q.options.forEach((opt, i) => {
                const label = document.createElement("label");
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = "mc";
                radio.value = i;
                if (userAnswers[index] === i) radio.checked = true;
                label.appendChild(radio);
                label.appendChild(document.createTextNode(` ${opt}`));
                optionsDiv.appendChild(label);
            });
            questionContainer.appendChild(optionsDiv);
        } else {
            const input = document.createElement("input");
            input.type = "text";
            input.id = "fillInput";
            input.className = "fill-input";
            input.placeholder = "Type your answer here...";
            if (userAnswers[index] !== null) input.value = userAnswers[index];
            questionContainer.appendChild(input);
        }
    }

    function updateUI() {
        if (quizCompleted) {
            progress.textContent = `Quiz Complete!`;
            timerDisplay.textContent = `00:00`;
            loadQuestion(currentIndex);
            nextBtn.style.display = "none";
            finishBtn.style.display = "none";
            backBtn.style.display = "inline-block";
            resultBox.style.display = "block";
            resultBox.className = "result-success";
        } else {
            loadQuestion(currentIndex);
            if (currentIndex === questions.length - 1) {
                nextBtn.style.display = "none";
                finishBtn.style.display = "inline-block";
                backBtn.style.display = currentIndex > 0 ? "inline-block" : "none";
            } else if (currentIndex === 0) {
                nextBtn.style.display = "inline-block";
                finishBtn.style.display = "none";
                backBtn.style.display = "none";
            } else {
                nextBtn.style.display = "inline-block";
                finishBtn.style.display = "none";
                backBtn.style.display = "inline-block";
            }
            resultBox.style.display = "none";
        }
        saveQuizState();
    }

    function saveCurrentAnswer() {
        if (quizCompleted) return;
        const q = questions[currentIndex];
        if (q.type === "mc") {
            const checked = document.querySelector('input[name="mc"]:checked');
            userAnswers[currentIndex] = checked ? parseInt(checked.value) : null;
        } else {
            const input = document.getElementById("fillInput");
            userAnswers[currentIndex] = input ? input.value.trim() : "";
        }
        saveQuizState();
    }

    function calculateScore() {
        let score = 0;
        questions.forEach((q, i) => {
            if (q.type === "mc") {
                if (userAnswers[i] === q.correct) score++;
            } else {
                const user = (userAnswers[i] || "").trim().toLowerCase();
                const correct = q.correctText.toLowerCase();
                if (user === correct) score++;
            }
        });
        return score;
    }

    function finishQuiz() {
        if (quizCompleted) return;
        quizCompleted = true;
        currentIndex = questions.length - 1;
        saveCurrentAnswer();
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        
        const total = questions.length;
        const score = calculateScore();
        const percentage = Math.round((score / total) * 100);

        resultBox.innerHTML = `
            <strong>FINAL SCORE: ${score} / ${total}</strong><br>
            <span style="font-size:8px;">${percentage}% - Variable mastery logged!</span>
        `;
        
        updateUI();
        console.log("üß™ JS Lesson 4 Quiz Complete:", score, "/", total, `(${percentage}%)`);
    }

    // Event listeners
    nextBtn.addEventListener("click", () => {
        if (quizCompleted) return;
        saveCurrentAnswer();
        if (currentIndex < questions.length - 1) {
            currentIndex++;
            updateUI();
        }
    });

    finishBtn.addEventListener("click", () => finishQuiz());

    backBtn.addEventListener("click", () => {
        if (quizCompleted) {
            window.location.href = "../../../Webside/Student.html";
        } else {
            saveCurrentAnswer();
            if (currentIndex > 0) {
                currentIndex--;
                updateUI();
            }
        }
    });

    // Initialize
    loadQuizState();
    updateUI();
    
    if (!quizCompleted && remainingSeconds > 0) {
        startTimer();
    }
    
    setInterval(saveQuizState, 5000);
</script>
</body>
</html>
