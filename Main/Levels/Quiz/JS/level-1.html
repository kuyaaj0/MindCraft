<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Lesson 1 Quiz (Step-by-Step)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto+Mono:wght@300;400&family=Press+Start+2P&display=swap');

        *{margin:0;padding:0;box-sizing:border-box;}

        body{
            font-family:'Orbitron',monospace;
            background:#000;
            color:#e0e0e0;
            min-height:100vh;
            padding:30px;
        }

        .container{
            max-width:800px;
            margin:0 auto;
            background:rgba(8,8,25,0.97);
            border-radius:20px;
            border:3px solid transparent;
            border-image:linear-gradient(45deg,#ff00ff,#00ffff,#ff1493)1;
            box-shadow:0 0 50px rgba(255,0,255,0.5);
            padding:35px 30px 30px;
            position: relative;
        }

        h1{
            text-align:center;
            font-size:2.4em;
            margin-bottom:5px;
            background:linear-gradient(135deg,#ff00ff,#00ffff,#ff1493);
            background-clip:text;
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
        }

        .subtitle{
            text-align:center;
            color:#00ffff;
            margin-bottom:20px;
        }

        .timer-container{
            text-align:center;
            margin-bottom:20px;
        }

        #timer{
            font-family:'Roboto Mono',monospace;
            font-size:2em;
            color:#ff4757;
            font-weight:700;
            text-shadow:0 0 10px rgba(255,71,87,0.8);
            display:inline-block;
            background:rgba(255,71,87,0.1);
            padding:10px 20px;
            border-radius:12px;
            border:2px solid #ff4757;
        }

        #progress{
            text-align:center;
            margin-bottom:20px;
            font-family:'Roboto Mono',monospace;
            color:#00ff88;
        }

        .question-box{
            background:rgba(0,255,255,0.05);
            border-left:4px solid #00ffff;
            border-radius:14px;
            padding:18px 20px 15px;
            margin-bottom:18px;
            font-family:'Roboto Mono',monospace;
        }

        .question-text{
            margin-bottom:12px;
        }

        .options label{
            display:block;
            margin:4px 0;
            cursor:pointer;
        }

        .options input{
            margin-right:7px;
        }

        .fill-input{
            width:100%;
            max-width:320px;
            padding:8px 10px;
            border-radius:8px;
            border:1px solid #00ffff;
            background:#050515;
            color:#00ffff;
            font-family:'Roboto Mono',monospace;
        }

        .nav-row{
            display:flex;
            justify-content:center;
            gap:10px;
            margin-top:10px;
        }

        button{
            font-family:'Orbitron',monospace;
            font-weight:700;
            padding:12px 25px;
            border-radius:14px;
            border:none;
            cursor:pointer;
            font-size:1rem;
        }

        #nextBtn{
            background:linear-gradient(45deg,#ff00ff,#00ffff);
            color:#000;
            box-shadow:0 0 20px rgba(255,0,255,0.7);
        }

        #finishBtn{
            background:#ff1493;
            color:#000;
            box-shadow:0 0 20px rgba(255,20,147,0.7);
            display:none;
        }

        #resultBox{
            margin-top:18px;
            padding:25px;
            border-radius:12px;
            background:rgba(0,0,0,0.7);
            border:2px solid #00ffff;
            font-family:'Roboto Mono',monospace;
            color:#00ff88;
            display:none;
            text-align:center;
        }

        .score-header{
            font-size:1.5em;
            color:#00ff88;
            margin-bottom:20px;
        }

        .score-details{
            background:rgba(0,255,136,0.15);
            padding:20px;
            border-radius:10px;
            margin:20px 0;
            border-left:4px solid #00ff88;
        }

        #scoreStatus{
            font-size:1.2em;
            margin-top:10px;
            font-weight:700;
        }

        .exit-btn{
            position: fixed;
            top: 480px;
            left: 202px;
            background: #ff4d4d;
            color: #fff;
            text-decoration: none;
            font-family: 'Press Start 2P';
            padding: 6px 10px;
            border-radius: 8px;
            box-shadow: inset -2px -2px 0 rgba(0,0,0,.25), 0 3px 0 #a30000;
            z-index: 1000;
            font-size: 9px;
            transition: transform 0.1s;
            display: none;  /* HIDDEN UNTIL SUBMIT */
        }

        .exit-btn:hover{
            transform: translateY(-2px);
        }

        @media(max-width:600px){
            .container{padding:25px 18px;}
            h1{font-size:2em;}
            .nav-row{flex-direction:column;}
            .nav-row button{width:100%;}
            .exit-btn{top: 450px; left: 50px;}
            #timer{font-size:1.5em;}
        }
    </style>
</head>
<body>
    <a href="../../../Webside/Student.html" class="exit-btn" id="exitBtn">BACK</a>

    <div class="container">
        <h1>JS Lesson 1 Quiz</h1>
        <p class="subtitle">One Question at a Time ‚Ä¢ Cyberpunk Matrix</p>
        
        <div class="timer-container">
            <div id="timer">10:00</div>
        </div>

        <p id="progress">Question 1 / 15</p>

        <div id="questionContainer" class="question-box">
            <!-- question content injected by JS -->
        </div>

        <div class="nav-row">
            <button id="nextBtn">Next ‚ü∂</button>
            <button id="finishBtn">üöÄ Finish Quiz</button>
        </div>

        <div id="resultBox">
            <div class="score-header">üéØ Quiz Complete!</div>
            <div class="score-details">
                <div style="font-size:1.4em;"><strong>Score:</strong> <span id="finalScore">0</span></div>
                <div style="font-size:1.2em; margin-top:8px;">of 15 ‚Ä¢ <span id="percentage">0%</span></div>
                <div id="scoreStatus"></div>
            </div>
            <div style="color:#00ffff; font-size:0.95em; margin-top:15px;">
                Press F12 ‚Üí Console for cyberpunk results log. üîç
            </div>
        </div>
    </div>

<script>
    // PERSISTENT STATE - REMEMBERS TIMER + QUESTION ON REFRESH
    let timeLeft = 600;
    let timerInterval;
    let currentIndex = 0;
    const userAnswers = new Array(15).fill(null);
    const timerEl = document.getElementById('timer');

    // RESTORE STATE FROM PREVIOUS SESSION
    const savedTime = sessionStorage.getItem('quizTimeLeft');
    const savedIndex = sessionStorage.getItem('quizCurrentIndex');
    const savedAnswers = sessionStorage.getItem('quizUserAnswers');
    
    if (savedTime !== null) timeLeft = parseInt(savedTime);
    if (savedIndex !== null) currentIndex = parseInt(savedIndex);
    if (savedAnswers !== null) userAnswers.splice(0, userAnswers.length, ...JSON.parse(savedAnswers));

    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 60) {
            timerEl.style.color = '#ff0000';
            timerEl.style.textShadow = '0 0 15px #ff0000';
        } else {
            timerEl.style.color = '#ff4757';
        }
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimer();
            sessionStorage.setItem('quizTimeLeft', timeLeft);
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                saveCurrentAnswer();
                showResults();
            }
        }, 1000);
    }

    // Pause when switching tabs
    document.addEventListener('visibilitychange', function() {
        if (document.hidden && timerInterval) {
            clearInterval(timerInterval);
        } else if (!document.hidden && timeLeft > 0 && !timerInterval) {
            startTimer();
        }
    });

    // ALL 15 QUESTIONS
    const questions = [
        {type: "mc", text: "1. What does JavaScript mainly add to a web page?", options: ["Structure and basic content","Styling and colors","Interactivity and behavior","Server hardware control"], correct: 2},
        {type: "mc", text: "2. In the lesson, JavaScript is compared to which part of a website?", options: ["Skeleton","Skin","Brain","Heart"], correct: 2},
        {type: "mc", text: "3. Which statement correctly describes the <script> tag?", options: ["It is only allowed inside <body>","It is used to write or link JavaScript code","It is used to link CSS files only","It is used to display images"], correct: 1},
        {type: "mc", text: "4. According to the lesson, which location is often the \"BEST\" place for script tags for performance?", options: ["At the very top of <head> (without defer)","Immediately after <html>","At the end of the <body>","Before the <!DOCTYPE> line"], correct: 2},
        {type: "mc", text: "5. Which JavaScript function prints messages to the browser's console?", options: ["alert()","console.write()","console.log()","document.print()"], correct: 2},
        {type: "mc", text: "6. Which browser shortcut opens Developer Tools (Console)?", options: ["Ctrl + S","F12","Ctrl + P","Alt + Tab"], correct: 1},
        {type: "mc", text: "7. What does alert() do in JavaScript?", options: ["Writes text into the HTML file","Shows a popup message box","Changes the background color","Closes the browser"], correct: 1},
        {type: "mc", text: "8. Which method is used to select an element by its id?", options: ["document.getElementByClass()","document.querySelectorAll()","document.getElementById()","window.selectById()"], correct: 2},
        {type: "mc", text: "9. What does the innerHTML property change?", options: ["The URL of the page","The HTML content inside an element","Only the text color","The browser's title bar"], correct: 1},
        {type: "mc", text: "10. Why is using an external .js file recommended in larger projects?", options: ["It makes HTML invalid","It keeps JavaScript code organized and reusable","It automatically styles the page","It disables the console"], correct: 1},
        {type: "fill", text: "11. JavaScript is often described as the ________ of the website because it controls behavior and logic.", correctText: "brain"},
        {type: "fill", text: "12. The function used to show popup messages in the browser is ________().", correctText: "alert"},
        {type: "fill", text: "13. The function used to send messages to the Console is ________.log().", correctText: "console"},
        {type: "fill", text: "14. To select an element with id matrixDisplay, you use document.________(\"matrixDisplay\").", correctText: "getElementById"},
        {type: "fill", text: "15. To change the HTML content inside an element, you use the property ________.", correctText: "innerHTML"}
    ];

    const questionContainer = document.getElementById("questionContainer");
    const progress = document.getElementById("progress");
    const nextBtn = document.getElementById("nextBtn");
    const finishBtn = document.getElementById("finishBtn");
    const resultBox = document.getElementById("resultBox");
    const finalScoreEl = document.getElementById("finalScore");
    const percentageEl = document.getElementById("percentage");
    const scoreStatusEl = document.getElementById("scoreStatus");
    const exitBtn = document.getElementById("exitBtn");

    function loadQuestion(index){
        const q = questions[index];
        progress.textContent = `Question ${index+1} / ${questions.length}`;
        questionContainer.innerHTML = "";

        const p = document.createElement("p");
        p.className = "question-text";
        p.textContent = q.text;
        questionContainer.appendChild(p);

        if(q.type === "mc"){
            const optionsDiv = document.createElement("div");
            optionsDiv.className = "options";
            q.options.forEach((opt,i)=>{
                const label = document.createElement("label");
                const radio = document.createElement("input");
                radio.type = "radio";
                radio.name = "mc";
                radio.value = i;
                if(userAnswers[index] === i){ radio.checked = true; }
                label.appendChild(radio);
                label.appendChild(document.createTextNode(opt));
                optionsDiv.appendChild(label);
            });
            questionContainer.appendChild(optionsDiv);
        }else{
            const input = document.createElement("input");
            input.type = "text";
            input.id = "fillInput";
            input.className = "fill-input";
            input.placeholder = "Type your answer here";
            if(userAnswers[index] !== null) input.value = userAnswers[index];
            questionContainer.appendChild(input);
        }

        if(index === questions.length - 1){
            nextBtn.style.display = "none";
            finishBtn.style.display = "inline-block";
        }else{
            nextBtn.style.display = "inline-block";
            finishBtn.style.display = "none";
        }
        sessionStorage.setItem('quizCurrentIndex', currentIndex);
    }

    function saveCurrentAnswer(){
        const q = questions[currentIndex];
        if(q.type === "mc"){
            const checked = document.querySelector('input[name="mc"]:checked');
            userAnswers[currentIndex] = checked ? parseInt(checked.value) : null;
        }else{
            const input = document.getElementById("fillInput");
            userAnswers[currentIndex] = input.value;
        }
        sessionStorage.setItem('quizUserAnswers', JSON.stringify(userAnswers));
    }

    function calculateScore(){
        let score = 0;
        questions.forEach((q,i)=>{
            if(q.type === "mc"){
                if(userAnswers[i] === q.correct){ score++; }
            }else{
                const user = (userAnswers[i] || "").trim().toLowerCase();
                const correct = q.correctText.toLowerCase();
                if(user === correct){ score++; }
            }
        });
        return score;
    }

    function showResults(){
        clearInterval(timerInterval);
        sessionStorage.setItem('quizTimeLeft', timeLeft);
        const total = questions.length;
        const score = calculateScore();
        const percentage = Math.round((score / total) * 100);
        
        finalScoreEl.textContent = score;  // FIXED - No extra 15!
        percentageEl.textContent = `${percentage}%`;
        
        let status = "";
        if(percentage >= 90) status = "üöÄ Cyber Elite!";
        else if(percentage >= 80) status = "üåü Matrix Master";
        else if(percentage >= 70) status = "‚ö° Code Warrior";
        else if(percentage >= 60) status = "üíª Solid Progress";
        else if(percentage >= 50) status = "üîÑ Keep Coding!";
        else status = "üî• Review & Retry!";
        
        scoreStatusEl.innerHTML = `<div style="font-size:1.1em; margin-top:8px;">${status}</div>`;
        
        progress.style.display = "none";
        questionContainer.style.display = "none";
        nextBtn.style.display = "none";
        finishBtn.style.display = "none";
        resultBox.style.display = "block";
        exitBtn.style.display = "inline-block";  // BACK BUTTON ONLY AFTER SUBMIT
        
        console.log("üß™ JS Lesson 1 Quiz Score:", score + " / " + total, "(" + percentage + "%)");
    }

    nextBtn.addEventListener("click",()=>{
        saveCurrentAnswer();
        if(currentIndex < questions.length-1){
            currentIndex++;
            loadQuestion(currentIndex);
        }
    });

    finishBtn.addEventListener("click",()=>{
        saveCurrentAnswer();
        showResults();
    });

    // START QUIZ WITH PERSISTED STATE
    updateTimer();
    if (timeLeft > 0) startTimer();
    loadQuestion(currentIndex);
    console.log("üåå PERSISTENT QUIZ LOADED! Timer + Question saved on refresh! ‚úÖ");
</script>
</body>
</html>
