<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In - MindCraft</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../Design/Position.css">
<style>
body {     font-family: 'Poppins', sans-serif;     text-align: center;     background: #203a43;     color: white; }
input {     padding: 10px;     width: 70%;     margin: 10px;     border-radius: 8px;     border: none; }
button {     padding: 10px 20px;     border: none;     border-radius: 8px;     background: #1DB954;     color: white;     cursor: pointer; }
button:hover { background: #1ed760; }
.message { margin: 10px; color: #ff5252; }
</style>
</head>
<body>
<h2>ðŸ§  MindCraft - Sign In</h2>
<form id="signinForm">
  <input type="text" id="username" placeholder="Enter username" required><br>
  <input type="password" id="password" placeholder="Enter password" required><br>
  <button type="submit">Sign In</button>
</form>
<p class="message" id="message"></p>
<p>Donâ€™t have an account? <a href="signup.html" style="color:#1DB954;">Sign up here</a>.</p>

<script src="../Design/theme.js"></script>

<script>
// Initialize users in localStorage if not exist
if (!localStorage.getItem('users')) {
    localStorage.setItem('users', JSON.stringify([
        // Keeping this default user for easy testing
        { username: 'testuser', password: '123', level: 1, xp: 0 } 
    ]));
}

const form = document.getElementById('signinForm');
const messageEl = document.getElementById('message');

form.addEventListener('submit', function(e) {
    e.preventDefault();
    const usernameInput = document.getElementById('username').value.trim();
    const passwordInput = document.getElementById('password').value;
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.username === usernameInput);
    
    if (!user) {
        messageEl.textContent = "âŒ User not found!";
        return;
    }
    
    if (user.password !== passwordInput) {
        messageEl.textContent = "âŒ Invalid password!";
        return;
    }
    
    // Save current user name
    localStorage.setItem('currentUser', user.username);
    
    // â­ CRITICAL FIX: Ensure user-specific XP/Level keys exist
    // This is the core data used by levels.js
    if (!localStorage.getItem(`${user.username}_xp`)) {
        localStorage.setItem(`${user.username}_level`, user.level || 1);
        localStorage.setItem(`${user.username}_xp`, user.xp || 0);
        localStorage.setItem(`${user.username}_xpMax`, 100);
    }
    
    messageEl.style.color = "#1DB954";
    messageEl.textContent = "âœ… Sign in successful! Redirecting...";

    // Redirect to index.html (main dashboard)
    // The path from Main/Account/ is up two levels: ../../index.html
    setTimeout(() => {
        window.location.href = '../../index.html';
    }, 500);
});
</script>
</body>
</html>
