<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In - MindCraft</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="Main/Design/Position.css"> <!-- Updated path -->
<style>
body { 
    font-family: 'Press Start 2P', cursive; 
    text-align: center; 
    background: #203a43; 
    color: white; 
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}
input { 
    padding: 10px; 
    width: 70%; 
    margin: 10px; 
    border-radius: 8px; 
    border: none; 
    font-family: 'Press Start 2P', cursive;
    font-size: 0.6rem;
}
button { 
    padding: 10px 20px; 
    border: none; 
    border-radius: 8px; 
    background: #1DB954; 
    color: white; 
    cursor: pointer; 
    font-family: 'Press Start 2P', cursive;
    font-size: 0.6rem;
    margin: 5px;
    transition: background 0.3s;
}
button:hover { background: #1ed760; }
.message { margin: 10px; color: #ff5252; font-size: 0.6rem; }
.choice-section, .student-form, .teacher-form { display: none; }
.choice-section { display: block; }

/* === Back Buttons === */
.back-buttons {
    position: absolute;
    top: 20px;
    left: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.back-buttons button {
    width: 160px;
    background: #666;
}
.back-buttons button:hover { background: #888; }
</style>
</head>
<body>

<!-- üîô Back Buttons -->
<div class="back-buttons">
  <button id="homeBtn">üè† Home</button>
  <button id="formBackBtn" style="display:none;">‚¨Ö Back to Form</button>
</div>

<!-- Role Selection -->
<div class="choice-section" id="choiceSection">
    <h2>üß† MindCraft - Sign In</h2>
    <p>Choose your role:</p>
    <button id="studentBtn">Student</button>
    <button id="teacherBtn">Teacher</button>
</div>

<!-- Student Form -->
<div class="student-form" id="studentForm">
    <h2>Student Sign In</h2>
    <form id="studentSigninForm">
        <input type="email" id="studentEmail" placeholder="Enter Gmail" required><br>
        <input type="password" id="studentPassword" placeholder="Enter password" required><br>
        <button type="submit">Sign In</button>
    </form>
    <p class="message" id="studentMessage"></p>
    <p>Don‚Äôt have an account? <a href="signup.html" style="color:#1DB954;">Sign up here</a>.</p> <!-- Updated path -->
</div>

<!-- Teacher Form -->
<div class="teacher-form" id="teacherForm">
    <h2>Teacher Sign In</h2>
    <form id="teacherSigninForm">
        <input type="email" id="teacherEmail" placeholder="Enter DepEd email" required><br>
        <input type="password" id="teacherPassword" placeholder="Enter password" required><br>
        <button type="submit">Sign In</button>
    </form>
    <p class="message" id="teacherMessage"></p>
    <p>Don‚Äôt have an account? <a href="signup.html" style="color:#1DB954;">Sign up here</a>.</p> <!-- Updated path -->
</div>

<script type="module">
import { auth, db } from 'Main/System/Database/firebase.js'; // Updated path
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// ===== Navigation Buttons =====
document.getElementById("homeBtn").addEventListener("click", () => {
  window.location.href = "../../index.html"; // Updated path
});

// ====== UI Toggle Functions ======
function showStudentForm() {
    document.getElementById('choiceSection').style.display = 'none';
    document.getElementById('studentForm').style.display = 'block';
    document.getElementById('formBackBtn').style.display = 'block';
    document.getElementById('homeBtn').style.display = 'none';
}

function showTeacherForm() {
    document.getElementById('choiceSection').style.display = 'none';
    document.getElementById('teacherForm').style.display = 'block';
    document.getElementById('formBackBtn').style.display = 'block';
    document.getElementById('homeBtn').style.display = 'none';
}

function backToChoice() {
    document.getElementById('studentForm').style.display = 'none';
    document.getElementById('teacherForm').style.display = 'none';
    document.getElementById('choiceSection').style.display = 'block';
    document.getElementById('formBackBtn').style.display = 'none';
    document.getElementById('homeBtn').style.display = 'block';
    document.getElementById('studentSigninForm').reset();
    document.getElementById('teacherSigninForm').reset();
    document.getElementById('studentMessage').textContent = '';
    document.getElementById('teacherMessage').textContent = '';
}

// === Attach Events After DOM Ready ===
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("studentBtn").addEventListener("click", showStudentForm);
  document.getElementById("teacherBtn").addEventListener("click", showTeacherForm);
  document.getElementById("formBackBtn").addEventListener("click", backToChoice);
});

// ==== Student Sign In ====
document.getElementById('studentSigninForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('studentEmail').value.trim();
    const password = document.getElementById('studentPassword').value;
    const msg = document.getElementById('studentMessage');

    if (!email || !password) {
        msg.textContent = "‚ùå Please fill in all fields.";
        return;
    }

    try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const snap = await getDoc(doc(db, "users", userCred.user.uid));
        if (!snap.exists() || snap.data().role !== "student") {
            msg.textContent = "‚ùå This account is not a student.";
            return;
        }
        msg.style.color = "#1DB954";
        msg.textContent = "‚úÖ Sign in successful! Redirecting...";
        setTimeout(() => window.location.href = "Main/Webside/Student.html", 800); // Updated path
    } catch(err) {
        console.error("Sign-in error:", err); // DEBUG
        msg.textContent = `‚ùå ${err.message}`;
    }
});

// ==== Teacher Sign In ====
document.getElementById('teacherSigninForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('teacherEmail').value.trim();
    const password = document.getElementById('teacherPassword').value;
    const msg = document.getElementById('teacherMessage');

    if (!email || !password) {
        msg.textContent = "‚ùå Please fill in all fields.";
        return;
    }

    try {
        const userCred = await signInWithEmailAndPassword(auth, email, password);
        const snap = await getDoc(doc(db, "users", userCred.user.uid));
        if (!snap.exists() || snap.data().role !== "teacher") {
            msg.textContent = "‚ùå This account is not a teacher.";
            return;
        }
        msg.style.color = "#1DB954";
        msg.textContent = "‚úÖ Sign in successful! Redirecting...";
        setTimeout(() => window.location.href = "Main/Webside/Teacher.html", 800); // Updated path
    } catch(err) {
        console.error("Sign-in error:", err); // DEBUG
        msg.textContent = `‚ùå ${err.message}`;
    }
});
</script>

</body>
</html>
