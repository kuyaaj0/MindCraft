<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In | MindCraft</title>

<!-- FONT -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}

/* ===== BODY ===== */
body{
  font-family:'Baloo 2', cursive;
  min-height:100vh;
  background:linear-gradient(to bottom,#8fe9ff,#c8f7b0);
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
  overflow:hidden;
}

/* ===== FLOATING HOME BUTTON ===== */
.home-btn{
  position:absolute;
  top:20px;
  left:20px;
  background:linear-gradient(145deg,#ffae42,#e69500);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:999px;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 6px 0 #b36b00,0 12px 20px rgba(0,0,0,.3);
  transition:.15s;
  z-index:10;
}
.home-btn:hover{transform:translateY(-2px)}
.home-btn:active{transform:translateY(4px)}

/* ===== CLOUD BACKGROUND ===== */
body::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 30%, #fff 2px, transparent 3px),
    radial-gradient(circle at 70% 20%, #fff 2px, transparent 3px),
    radial-gradient(circle at 40% 80%, #fff 2px, transparent 3px);
  opacity:.35;
}

/* ===== CARD ===== */
.panel{
  position:relative;
  background:white;
  width:400px;
  padding:44px;
  border-radius:30px;
  text-align:center;
  box-shadow:0 24px 50px rgba(0,0,0,.25);
  animation:pop .4s ease;
}
@keyframes pop{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}

/* ===== TITLES ===== */
.title{
  font-size:46px;
  font-weight:800;
  color:#5a3a1a;
}
.subtitle{
  font-size:18px;
  color:#6d4c41;
  margin-bottom:28px;
}

/* ===== ROLE BUTTONS ===== */
.role-btn{
  font-size:20px;
  padding:18px;
  margin:10px 0;
}

/* ===== INPUTS ===== */
input{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  background:#f3f3f3;
  font-size:16px;
  margin-bottom:14px;
  font-family:'Baloo 2';
}

/* ===== BUTTONS ===== */
button{
  width:100%;
  background:linear-gradient(145deg,#b8783d,#8a5427);
  color:white;
  border:none;
  border-radius:22px;
  padding:16px;
  font-size:18px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 0 #4a2c12;
  transition:.15s;
}
button:hover{transform:translateY(-2px)}
button:active{transform:translateY(4px)}

.alt{
  background:#ffae42;
  box-shadow:0 6px 0 #cc8a24;
}

.back{
  margin-top:14px;
  background:#9e9e9e;
  box-shadow:0 6px 0 #616161;
}

/* ===== MESSAGE ===== */
.message{
  margin-top:12px;
  font-weight:700;
  color:#c62828;
  font-size:14px;
}

/* ===== LINKS ===== */
.auth-link{
  margin-top:14px;
  font-size:15px;
}
.auth-link a{
  color:#1db954;
  font-weight:800;
  text-decoration:none;
}
.auth-link a:hover{text-decoration:underline}

/* ===== HIDE SECTIONS ===== */
.student-form,.teacher-form{display:none}
</style>
</head>

<body>

<!-- HOME BUTTON -->
<button class="home-btn" onclick="location.href='../../index.html'">üè† Home</button>

<!-- ROLE CHOICE -->
<div class="panel choice-section" id="choiceSection">
  <div class="title">MindCraft</div>
  <div class="subtitle">Choose how you want to sign in</div>

  <button class="role-btn" id="studentBtn">üéì Student</button>
  <button class="role-btn" id="teacherBtn">üë©‚Äçüè´ Teacher</button>

  <div class="auth-link">
    New here? <a href="signup.html">Create an account</a>
  </div>
</div>

<!-- STUDENT SIGN IN -->
<div class="panel student-form" id="studentForm">
  <div class="title">Student Login</div>

  <form id="studentSigninForm">
    <input type="email" id="studentEmail" placeholder="Gmail" required>
    <input type="password" id="studentPassword" placeholder="Password" required>
    <button type="submit">Sign In</button>
  </form>

  <p class="message" id="studentMessage"></p>
  <button id="resendStudent" class="alt" style="display:none;">Resend Verification</button>

  <div class="auth-link">
    Don‚Äôt have an account? <a href="signup.html">Sign up</a>
  </div>

  <button class="back" onclick="backToChoice()">‚¨Ö Back</button>
</div>

<!-- TEACHER SIGN IN -->
<div class="panel teacher-form" id="teacherForm">
  <div class="title">Teacher Login</div>

  <form id="teacherSigninForm">
    <input type="email" id="teacherEmail" placeholder="DepEd Email" required>
    <input type="password" id="teacherPassword" placeholder="Password" required>
    <button type="submit">Sign In</button>
  </form>

  <p class="message" id="teacherMessage"></p>
  <button id="resendTeacher" class="alt" style="display:none;">Resend Verification</button>

  <div class="auth-link">
    Don‚Äôt have an account? <a href="signup.html">Sign up</a>
  </div>

  <button class="back" onclick="backToChoice()">‚¨Ö Back</button>
</div>

<!-- ===== UI TOGGLE SCRIPT ===== -->
<script>
function showStudentForm(){
  choiceSection.style.display="none";
  studentForm.style.display="block";
}
function showTeacherForm(){
  choiceSection.style.display="none";
  teacherForm.style.display="block";
}
function backToChoice(){
  studentForm.style.display="none";
  teacherForm.style.display="none";
  choiceSection.style.display="block";
  studentMessage.textContent="";
  teacherMessage.textContent="";
}

studentBtn.onclick = showStudentForm;
teacherBtn.onclick = showTeacherForm;
</script>

<!-- ===== FIREBASE AUTH (UNCHANGED) ===== -->
<script type="module">
import { auth, db } from '../System/Database/firebase.js';
import {
  signInWithEmailAndPassword,
  signOut,
  sendEmailVerification
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* STUDENT */
studentSigninForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const msg = studentMessage;
  msg.textContent="";
  resendStudent.style.display="none";

  try{
    const cred = await signInWithEmailAndPassword(auth,studentEmail.value,studentPassword.value);
    const user = cred.user;

    if(!user.emailVerified){
      msg.textContent="Verify your email first.";
      resendStudent.style.display="block";
      await signOut(auth);
      return;
    }

    const snap = await getDoc(doc(db,"users",user.uid));
    if(!snap.exists() || snap.data().role!=="student"){
      msg.textContent="Not a student account.";
      await signOut(auth);
      return;
    }

    msg.style.color="#1db954";
    msg.textContent="Login successful!";
    setTimeout(()=>location.href="../Startup/StartupS.html",1000);
  }catch(err){msg.textContent=err.message}
});

resendStudent.onclick = async()=>{
  try{
    const cred = await signInWithEmailAndPassword(auth,studentEmail.value,studentPassword.value);
    await sendEmailVerification(cred.user);
    studentMessage.textContent="Verification email sent!";
    await signOut(auth);
  }catch(err){studentMessage.textContent=err.message}
};

/* TEACHER */
teacherSigninForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const msg = teacherMessage;
  msg.textContent="";
  resendTeacher.style.display="none";

  try{
    const cred = await signInWithEmailAndPassword(auth,teacherEmail.value,teacherPassword.value);
    const user = cred.user;

    if(!user.emailVerified){
      msg.textContent="Verify your email first.";
      resendTeacher.style.display="block";
      await signOut(auth);
      return;
    }

    const snap = await getDoc(doc(db,"users",user.uid));
    if(!snap.exists() || snap.data().role!=="teacher"){
      msg.textContent="Not a teacher account.";
      await signOut(auth);
      return;
    }

    msg.style.color="#1db954";
    msg.textContent="Login successful!";
    setTimeout(()=>location.href="../Startup/StartupT.html",1000);
  }catch(err){msg.textContent=err.message}
});

resendTeacher.onclick = async()=>{
  try{
    const cred = await signInWithEmailAndPassword(auth,teacherEmail.value,teacherPassword.value);
    await sendEmailVerification(cred.user);
    teacherMessage.textContent="Verification email sent!";
    await signOut(auth);
  }catch(err){teacherMessage.textContent=err.message}
};
</script>

</body>
</html>
