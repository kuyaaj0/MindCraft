<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In - MindCraft</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../Design/Position.css">
<style>
body { 
    font-family: 'Press Start 2P', cursive; 
    text-align: center; 
    background: #203a43; 
    color: white; 
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}
input { 
    padding: 10px; 
    width: 70%; 
    margin: 10px; 
    border-radius: 8px; 
    border: none; 
    font-family: 'Press Start 2P', cursive;
    font-size: 0.6rem;
}
button { 
    padding: 10px 20px; 
    border: none; 
    border-radius: 8px; 
    background: #1DB954; 
    color: white; 
    cursor: pointer; 
    font-family: 'Press Start 2P', cursive;
    font-size: 0.6rem;
    margin: 5px;
    transition: background 0.3s;
}
button:hover { background: #1ed760; }
.message { margin: 10px; color: #ff5252; font-size: 0.6rem; }
.choice-section, .student-form, .teacher-form {
    display: none;
}
.choice-section { display: block; }
.back-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    background: #666;
}
.back-btn:hover { background: #888; }
.back-to-choice-btn {
    position: absolute;
    top: 20px;
    left: 20px;
    background: #666;
    display: none; /* Hidden by default */
}
.back-to-choice-btn:hover { background: #888; }
</style>
</head>
<body>

<!-- Back button to go to the landing page (index.html) -->
<button onclick="window.location.href='/index.html'">‚Üê Back to Landing</button>


<!-- Back button to go back to the choice section (hidden initially) -->
<!--button class="back-to-choice-btn" id="backToChoiceBtn" onclick="backToChoice()">‚Üê Back to Choice</button-->

<div class="choice-section" id="choiceSection">
    <h2>üß† MindCraft - Sign In</h2>
    <p>Choose your role:</p>
    <button onclick="showStudentForm()">Student</button>
    <button onclick="showTeacherForm()">Teacher</button>
</div>

<div class="student-form" id="studentForm">
    <h2>Student Sign In</h2>
    <form id="studentSigninForm">
        <input type="text" id="studentUsername" placeholder="Enter username" required><br>
        <input type="password" id="studentPassword" placeholder="Enter password" required><br>
        <button type="submit">Sign In</button>
    </form>
    <p class="message" id="studentMessage"></p>
    <button onclick="backToChoice()">Back to Choice</button>
    <p>Don‚Äôt have an account? <a href="signup.html" style="color:#1DB954;">Sign up here</a>.</p>
</div>

<div class="teacher-form" id="teacherForm">
    <h2>Teacher Sign In</h2>
    <form id="teacherSigninForm">
        <input type="email" id="teacherEmail" placeholder="Enter DepEd email" required><br>
        <input type="password" id="teacherPassword" placeholder="Enter password" required><br>
        <button type="submit">Sign In</button>
    </form>
    <p class="message" id="teacherMessage"></p>
    <button onclick="backToChoice()">Back to Choice</button>
    <p>Don‚Äôt have an account? <a href="signup.html" style="color:#1DB954;">Sign in here</a>.</p>
</div>

<script src="../Design/theme.js"></script>

<script>
// Initialize users in localStorage if not exist
if (!localStorage.getItem('users')) {
    localStorage.setItem('users', JSON.stringify([
        { username: 'testuser', password: '123', role: 'student', level: 1, xp: 0 } 
    ]));
}

// Functions to show/hide sections
function showStudentForm() {
    document.getElementById('choiceSection').style.display = 'none';
    document.getElementById('studentForm').style.display = 'block';
    document.getElementById('backToLandingBtn').style.display = 'none'; // Hide back to landing
    document.getElementById('backToChoiceBtn').style.display = 'inline-block'; // Show back to choice
}

function showTeacherForm() {
    document.getElementById('choiceSection').style.display = 'none';
    document.getElementById('teacherForm').style.display = 'block';
    document.getElementById('backToLandingBtn').style.display = 'none'; // Hide back to landing
    document.getElementById('backToChoiceBtn').style.display = 'inline-block'; // Show back to choice
}

function backToChoice() {
    document.getElementById('studentForm').style.display = 'none';
    document.getElementById('teacherForm').style.display = 'none';
    document.getElementById('choiceSection').style.display = 'block';
    document.getElementById('backToLandingBtn').style.display = 'inline-block'; // Show back to landing
    document.getElementById('backToChoiceBtn').style.display = 'none'; // Hide back to choice
    // Reset forms
    document.getElementById('studentSigninForm').reset();
    document.getElementById('teacherSigninForm').reset();
    document.getElementById('studentMessage').textContent = '';
    document.getElementById('teacherMessage').textContent = '';
}

// Student Sign In Logic
document.getElementById('studentSigninForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const usernameInput = document.getElementById('studentUsername').value.trim();
    const passwordInput = document.getElementById('studentPassword').value;
    const messageEl = document.getElementById('studentMessage');
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.username === usernameInput && u.role === 'student');
    
    if (!user) {
        messageEl.textContent = "‚ùå User not found!";
        return;
    }
    
    if (user.password !== passwordInput) {
        messageEl.textContent = "‚ùå Invalid password!";
        return;
    }
    
    localStorage.setItem('currentUser', user.username);
    localStorage.setItem('currentRole', user.role);
    
    if (!localStorage.getItem(`${user.username}_xp`)) {
        localStorage.setItem(`${user.username}_level`, user.level || 1);
        localStorage.setItem(`${user.username}_xp`, user.xp || 0);
        localStorage.setItem(`${user.username}_xpMax`, 100);
    }
    
    messageEl.style.color = "#1DB954";
    messageEl.textContent = "‚úÖ Sign in successful! Redirecting...";

    setTimeout(() => {
        window.location.href = '../mainPage.html';
    }, 500);
});

// Teacher Sign In Logic
document.getElementById('teacherSigninForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const emailInput = document.getElementById('teacherEmail').value.trim();
    const passwordInput = document.getElementById('teacherPassword').value;
    const messageEl = document.getElementById('teacherMessage');
    
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.username === emailInput && u.role === 'teacher');
    
    if (!user) {
        messageEl.textContent = "‚ùå User not found!";
        return;
    }
    
    if (user.password !== passwordInput) {
        messageEl.textContent = "‚ùå Invalid password!";
        return;
    }
    
    localStorage.setItem('currentUser', user.username);
    localStorage.setItem('currentRole', user.role);
    
    if (!localStorage.getItem(`${user.username}_xp`)) {
        localStorage.setItem(`${user.username}_level`, user.level || 1);
        localStorage.setItem(`${user.username}_xp`, user.xp || 0);
        localStorage.setItem(`${user.username}_xpMax`, 100);
    }
    
    messageEl.style.color = "#1DB954";
    messageEl.textContent = "‚úÖ Sign in successful! Redirecting...";

    setTimeout(() => {
        window.location.href = '../mainPage.html';
    }, 500);
});
</script>

</body>
</html>
