<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up | MindCraft</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:'Baloo 2', cursive;
  min-height:100vh;
  background:linear-gradient(to bottom,#8fe9ff,#c8f7b0);
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
}

body::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 30%, #fff 2px, transparent 3px),
    radial-gradient(circle at 70% 20%, #fff 2px, transparent 3px),
    radial-gradient(circle at 40% 80%, #fff 2px, transparent 3px);
  opacity:.25;
  pointer-events:none;
  z-index:0;
}

/* Back and Home Buttons */
.back-wrap, .home-wrap{
  position:absolute;
  top:24px;
  z-index:10;
}
.back-wrap { left:24px; display:none; }
.home-wrap { left:24px; }
.back-btn, .home-btn{
  padding:10px 18px;
  border-radius:18px;
  border:none;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 4px 0 #444;
}
.back-btn{ background:#666; color:white; box-shadow:0 4px 0 #444;}
.home-btn{ background:#ffae42; color:#5a3a1a; box-shadow:0 4px 0 #d8942f;}
.back-btn:hover, .home-btn:hover{transform:translateY(-1px);}
.back-btn:active, .home-btn:active{transform:translateY(2px);}

/* Panels */
.panel{
  background:white;
  width:400px;
  padding:36px;
  border-radius:26px;
  text-align:center;
  box-shadow:0 14px 28px rgba(0,0,0,.2);
  position: relative;
  z-index:1;
}

.title{
  font-size:38px;
  font-weight:800;
  color:#5a3a1a;
  margin-bottom:6px;
}
.subtitle{
  font-size:17px;
  color:#6d4c41;
  margin-bottom:24px;
}

/* Buttons */
button{
  width:100%;
  background:#b8783d;
  color:white;
  border:none;
  border-radius:18px;
  padding:14px;
  font-size:17px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 5px 0 #6b3e1a;
  transition:.2s;
  margin-bottom:12px;
}
button:hover{transform:translateY(-1px);}
button:active{transform:translateY(3px);}
.role-btn{margin-bottom:12px;}

/* Inputs */
input{
  width:100%;
  padding:13px;
  border-radius:14px;
  border:none;
  background:#f3f3f3;
  font-size:15px;
  margin-bottom:12px;
}

/* Messages & links */
.message{
  margin-top:10px;
  font-weight:700;
  color:#c62828;
  font-size:14px;
}
.auth-link{
  margin-top:14px;
  font-size:14px;
}
.auth-link a{
  color:#1db954;
  font-weight:700;
  text-decoration:none;
}

/* Toast */
.toast{
  position:fixed;
  bottom:24px;
  right:24px;
  background:#1db954;
  color:white;
  padding:14px 18px;
  border-radius:14px;
  font-weight:700;
  opacity:0;
  transform:translateY(20px);
  transition:.4s;
  z-index:9999;
}
.toast.show{opacity:1;transform:translateY(0);}
.toast.error{background:#c62828;}

/* Hide forms by default */
.student-form, .teacher-form{display:none;}
</style>
</head>

<body>

<!-- Back & Home Buttons -->
<div class="back-wrap"><button class="back-btn" id="backBtn">‚Üê Back</button></div>
<div class="home-wrap" id="homeWrap"><button class="home-btn" onclick="location.href='../../index.html'">Home</button></div>

<!-- Role Choice -->
<div class="panel" id="choiceSection">
  <div class="title">MindCraft</div>
  <div class="subtitle">Choose your role to sign up</div>
  <button class="role-btn" id="studentBtn">Student</button>
  <button class="role-btn" id="teacherBtn">Teacher</button>
  <div class="auth-link">
    Already have an account? <a href="signin.html">Sign in</a>
  </div>
</div>

<!-- Student Sign Up -->
<div class="panel student-form" id="studentForm">
  <div class="title">Student Sign Up</div>
  <form id="studentSignupForm">
    <input type="text" id="studentName" placeholder="Full name" required>
    <input type="email" id="studentEmail" placeholder="Gmail address" required>
    <input type="password" id="studentPassword" placeholder="Password" required>
    <button type="submit">Create Account</button>
  </form>
  <p class="message" id="studentMessage"></p>
</div>

<!-- Teacher Sign Up -->
<div class="panel teacher-form" id="teacherForm">
  <div class="title">Teacher Sign Up</div>
  <div class="subtitle">DepEd email required</div>
  <form id="teacherSignupForm">
    <input type="text" id="teacherName" placeholder="Full name" required>
    <input type="email" id="teacherEmail" placeholder="DepEd email" required>
    <input type="password" id="teacherPassword" placeholder="Password" required>
    <button type="submit">Create Account</button>
  </form>
  <p class="message" id="teacherMessage"></p>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { auth, db } from '../System/Database/firebase.js';
import { createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { setDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ==== ELEMENTS ==== */
const studentBtn = document.getElementById("studentBtn");
const teacherBtn = document.getElementById("teacherBtn");
const choiceSection = document.getElementById("choiceSection");
const studentForm = document.getElementById("studentForm");
const teacherForm = document.getElementById("teacherForm");
const backWrap = document.querySelector(".back-wrap");
const backBtn = document.getElementById("backBtn");
const homeWrap = document.getElementById("homeWrap");

/* ==== UI TOGGLE ==== */
studentBtn.addEventListener("click", () => {
  choiceSection.style.display = "none";
  studentForm.style.display = "block";
  backWrap.style.display = "block";
  homeWrap.style.display = "none";
});
teacherBtn.addEventListener("click", () => {
  choiceSection.style.display = "none";
  teacherForm.style.display = "block";
  backWrap.style.display = "block";
  homeWrap.style.display = "none";
});
backBtn.addEventListener("click", () => {
  studentForm.style.display = "none";
  teacherForm.style.display = "none";
  choiceSection.style.display = "block";
  backWrap.style.display = "none";
  homeWrap.style.display = "block";
});

/* ==== TOAST ==== */
function showToast(msg, isError=false){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.className = "toast show" + (isError?" error":"");
  setTimeout(()=>t.className="toast",3000);
}

/* ==== STUDENT SIGN UP ==== */
const studentSignupForm = document.getElementById("studentSignupForm");
studentSignupForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("studentName").value.trim();
  const email = document.getElementById("studentEmail").value.trim();
  const password = document.getElementById("studentPassword").value;
  const msg = document.getElementById("studentMessage");

  try{
    const user = await createUserWithEmailAndPassword(auth,email,password);
    await setDoc(doc(db,"users",user.user.uid),{
      name,email,role:"student",verified:false,
      level:1,xp:0,xpMax:100,totalXP:0,
      completedLessons:[],completedQuizzes:[],
      createdAt:new Date()
    });
    await sendEmailVerification(user.user);
    msg.style.color="#1DB954";
    msg.textContent="Account created! Check Gmail to verify.";
    showToast("Verification email sent!");
    setTimeout(()=>location.href="signin.html",3000);
  }catch(err){
    msg.style.color="#ff5252";
    msg.textContent=err.message;
    showToast(err.message,true);
  }
});

/* ==== TEACHER SIGN UP ==== */
const teacherSignupForm = document.getElementById("teacherSignupForm");
teacherSignupForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const name = document.getElementById("teacherName").value.trim();
  const email = document.getElementById("teacherEmail").value.trim();
  const password = document.getElementById("teacherPassword").value;
  const msg = document.getElementById("teacherMessage");

  if(!email.includes("@ed.gov") && !email.includes("@deped.gov.ph")){
    msg.style.color="#ff5252";
    msg.textContent="Invalid DepEd email.";
    return;
  }

  try{
    const user = await createUserWithEmailAndPassword(auth,email,password);
    await setDoc(doc(db,"users",user.user.uid),{
      name,email,role:"teacher",verified:true,createdAt:new Date()
    });
    msg.style.color="#1DB954";
    msg.textContent="Teacher account created! You can now sign in.";
    showToast("Teacher account created!");
    setTimeout(()=>location.href="signin.html",2500);
  }catch(err){
    msg.style.color="#ff5252";
    msg.textContent=err.message;
    showToast(err.message,true);
  }
});
</script>
</body>
</html>
<!--fixed and needs to be tested so it would be my backup plan-->
